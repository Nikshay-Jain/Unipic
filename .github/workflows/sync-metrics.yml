# .github/workflows/sync-metrics.yml
name: Sync Metrics
on:
  repository_dispatch:
    types: [metrics-update]
  schedule:
    - cron: '0 * * * *'  # Every hour (fallback if webhook fails)

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Update metrics from payload
        env:
          METRICS_DATA: ${{ github.event.client_payload.metrics }}
        run: |
          # If triggered by webhook, use the payload data
          if [ ! -z "$METRICS_DATA" ]; then
            echo "$METRICS_DATA" >> metrics.csv
          fi
      
      - name: Commit metrics
        run: |
          git config user.name "Unipic Bot"
          git config user.email "bot@unipic.local"
          git add metrics.csv
          git diff --cached --quiet || git commit -m "docs: auto-update metrics from Streamlit Cloud"
          git push